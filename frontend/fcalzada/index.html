<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Carros</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
    }
    .form-container, .car-list {
      max-width: 600px;
      margin: 0 auto;
    }
    label, input, button {
      display: block;
      width: 100%;
      margin-bottom: 10px;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px;
      cursor: pointer;
    }
    button:hover {
      background: #45a049;
    }
    .car-item {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      background: #f9f9f9;
    }
    .delete-btn {
      background: #f44336;
    }
    .delete-btn:hover {
      background: #d32f2f;
    }
  </style>
</head>
<body>

<h1>Registro de Carros</h1>

<div class="form-container">
  <h2>Alta de Carro</h2>
  <label>Marca:</label>
  <input type="text" id="marca" placeholder="Marca" required>

  <label>Modelo:</label>
  <input type="text" id="modelo" placeholder="Modelo" required>

  <label>Año:</label>
  <input type="number" id="año" placeholder="Año" required>

  <label>Color:</label>
  <input type="text" id="color" placeholder="Color" required>

  <button onclick="agregarCarro()">Registrar Carro</button>
</div>

<div class="form-container">
  <h2>Baja de Carro</h2>
  <label>ID del Carro a Eliminar:</label>
  <input type="number" id="carroId" placeholder="ID" required>
  <button onclick="eliminarCarro()">Eliminar Carro</button>
</div>

<div class="car-list">
  <h2>Carros Registrados</h2>
  <button onclick="cargarCarros()">Mostrar Carros</button>
  <div id="carros"></div>
</div>

<script>
  const API_URL = "http://127.0.0.1:8000/api/v1/fcalzada";

 // Alta de carro (PUT)
async function agregarCarro() {
  const marca = document.getElementById("marca").value;
  const modelo = document.getElementById("modelo").value;
  const año = parseInt(document.getElementById("año").value);
  const color = document.getElementById("color").value;

  if (!marca || !modelo || !año || !color) {
    alert("Por favor, completa todos los campos.");
    return;
  }

  const data = {
    marca,
    modelo,
    año,
    color
  };

  try {
    const response = await fetch(`${API_URL}/registro_carro/registro/entrada/1`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    if (response.ok) {
      alert("Carro registrado exitosamente");
      cargarCarros();
    } else {
      const error = await response.json();
      alert(`Error: ${error.detail || error.message || "No se pudo registrar el carro"}`);
    }
  } catch (error) {
    console.error("Error:", error);
    alert("Error de conexión con el servidor.");
  }
}

// Baja de carro (DELETE)
async function eliminarCarro() {
  const carroId = parseInt(document.getElementById("carroId").value);

  if (!carroId) {
    alert("Por favor, introduce un ID válido.");
    return;
  }

  try {
    const response = await fetch(`${API_URL}/registro_carro/eliminar/${carroId}`, {
      method: "DELETE",
    });

    if (response.ok) {
      alert("Carro eliminado exitosamente");
      cargarCarros();
    } else {
      alert("Error al eliminar el carro");
    }
  } catch (error) {
    console.error("Error:", error);
    alert("Error de conexión con el servidor.");
  }
}

// Mostrar todos los carros (GET)
async function cargarCarros() {
  const carrosDiv = document.getElementById("carros");
  carrosDiv.innerHTML = "";

  try {
    const response = await fetch(`${API_URL}/registro_carro/carros`);

    if (!response.ok) {
      alert("Error al cargar carros.");
      return;
    }

    const carros = await response.json();

    if (carros.length === 0) {
      carrosDiv.innerHTML = "<p>No hay carros registrados.</p>";
      return;
    }

    carros.forEach(carro => {
      const div = document.createElement("div");
      div.classList.add("car-item");
      div.innerHTML = `
        <p><strong>ID:</strong> ${carro.id}</p>
        <p><strong>Marca:</strong> ${carro.marca}</p>
        <p><strong>Modelo:</strong> ${carro.modelo}</p>
        <p><strong>Año:</strong> ${carro.año}</p>
        <p><strong>Color:</strong> ${carro.color}</p>
        <p><strong>Fecha:</strong> ${new Date(carro.created_at).toLocaleString()}</p>
      `;
      carrosDiv.appendChild(div);
    });

  } catch (error) {
    console.error("Error:", error);
    alert("Error al cargar los carros");
  }
}
</script>

</body>
</html>
